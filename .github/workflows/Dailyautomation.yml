name: Run Battle Script

on:
  workflow_dispatch:  # 手動実行 & API実行

jobs:
  run-script:
    runs-on: ubuntu-latest
    
    steps:
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install Playwright
        run: |
          npm init -y
          npm install playwright
          npx playwright install chromium
      
      - name: Create script from secret
        run: |
          echo "${{ secrets.SCRIPT_WAR }}" > go-to-battle.js
      
      - name: Run battle script
        run: |
          node go-to-battle.js
        timeout-minutes: 30
      
      - name: Cleanup
        if: always()
        run: |
          rm -f go-to-battle.js
